<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Activity Record Entry | Mentor Tracker</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    /* === Global Styles === */
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #e3f2fd, #ffffff);
      margin: 0;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      justify-content: flex-start;
      align-items: center;
      min-height: 100vh;
      box-sizing: border-box;
    }

    /* === Top Navigation === */
    .top-nav {
      width: 100%;
      max-width: 1100px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.75rem;
      background: #2a348d;
      border-radius: 16px;
      padding: 0.75rem 1.5rem;
      border: 4px solid rgba(42, 52, 141, 0.2);
      box-shadow: 0 6px 18px rgba(42, 52, 141, 0.3);
    }

    .top-nav a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      text-decoration: none;
      font-weight: 600;
      padding: 0.55rem 1rem;
      border-radius: 10px;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .top-nav a:hover,
    .top-nav a:focus {
      background-color: rgba(255, 255, 255, 0.18);
      transform: translateY(-1px);
      outline: none;
    }

    .top-nav .active {
      background-color: rgba(255, 255, 255, 0.3);
      color: #2a348d;
    }

    /* === Card Container === */
    .container {
      max-width: 950px;
      width: 100%;
      background: #fff;
      padding: 2rem 2.5rem;
      border-radius: 20px;
      border: 6px solid #2a348d;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      animation: fadeIn 0.6s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* === Logo & Heading === */
    .logo {
      width: 90px;
      display: block;
      margin: 0 auto 1rem auto;
    }

    h2 {
      text-align: center;
      color: #0d47a1;
      margin-bottom: 0.5rem;
      font-weight: 700;
    }

    h3 {
      text-align: center;
      color: #333;
      font-weight: 600;
      margin-top: 0.5rem;
    }

    /* === Embedded Activity List === */
    iframe {
      width: 100%;
      height: 450px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      margin-top: 1rem;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
    }

    /* === Form Labels & Inputs === */
    label {
      display: block;
      margin-top: 1rem;
      font-weight: 600;
      color: #333;
    }

    input, select {
      width: 100%;
      padding: 0.7rem;
      margin-top: 0.3rem;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    input:focus, select:focus {
      border-color: #1976d2;
      box-shadow: 0 0 6px rgba(25, 118, 210, 0.3);
      outline: none;
    }

  /* === Dynamic Activity Rows === */
    .activity-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px;
      margin-top: 1rem;
      align-items: center;
      padding: 0.8rem;
      border: 1px solid #e0e0e0;
      border-radius: 10px;
      background: #fafafa;
      animation: fadeInRow 0.4s ease;
    }

    .activity-row input,.activity-row select {
      min-width: 150px;
      padding: 0.6rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.95rem;
      box-sizing: border-box;
    }

    .activity-row input:focus,.activity-row select:focus {
      border-color: #1976d2;
      box-shadow: 0 0 4px rgba(25, 118, 210, 0.3);
      outline: none;
    }

    @keyframes fadeInRow {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* === Delete Button === */
    .delete-btn {
    background-color: #e53935;
    color: white;
    border: none;
    border-radius: 50%;
    width: 34px;
    height: 34px;
    font-size: 1.3rem;
    cursor: pointer;
    align-self: center;
    justify-self: center;
    transition: all 0.2s ease;
  }

    .delete-btn:hover {
      transform: scale(1.15);
    }

    /* === Buttons === */
    .button-row {
      text-align: center;
      margin-top: 2rem;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.55rem;
      background: rgba(42, 52, 141, 0.1);
      color: #2a348d;
      text-decoration: none;
      font-weight: 600;
      padding: 0.4rem 0.95rem 0.4rem 0.4rem;
      border-radius: 999px;
      border: 1px solid rgba(42, 52, 141, 0.25);
      box-shadow: 0 4px 12px rgba(42, 52, 141, 0.2);
      transition: background-color 0.3s ease, box-shadow 0.3s ease, transform 0.2s ease;
      margin-bottom: 1rem;
      width: fit-content;
    }

    .back-btn .back-icon {
      display: inline-grid;
      place-items: center;
      width: 34px;
      height: 34px;
      border-radius: 50%;
      background: #2a348d;
      color: #ffffff;
      font-size: 1.05rem;
      line-height: 1;
      box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.15);
    }

    .back-btn:hover,
    .back-btn:focus {
      background-color: rgba(42, 52, 141, 0.18);
      box-shadow: 0 6px 16px rgba(42, 52, 141, 0.25);
      transform: translateY(-1px);
      outline: none;
    }

    .add-btn, .submit-btn {
      background-color: #2a348d;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      padding: 0.8rem 1.5rem;
      margin: 0.5rem;
      transition: all 0.3s ease;
      box-shadow: 0 3px 8px rgba(25,118,210,0.2);
    }

    .add-btn:hover {
      background-color: #0d47a1;
      transform: translateY(-2px);
    }

    .submit-btn {
      display: block;
      width: 60%;
      margin: 2rem auto 0 auto;
      background-color: #2a348d;
    }

    .submit-btn:hover {
      background-color: #0d47a1;
      transform: translateY(-2px);
    }

    /* === Loader === */
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #2a348d;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      display: inline-block;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* === Message === */
    .message {
      margin-top: 1rem;
      font-weight: bold;
      text-align: center;
    }
    .success { color: green; }
    .error { color: red; }
    .wait { color: #d32f2f; }

    /* === Responsive === */
    @media (max-width: 600px) {
      body {
        padding: 1.5rem 1rem;
        gap: 1rem;
      }
      .top-nav {
        gap: 0.5rem;
        padding: 0.75rem 1rem;
      }
      .top-nav a {
        flex: 1 1 130px;
      }
      .container {
        padding: 1.5rem;
      }
      iframe {
        height: 400px;
      }
      .submit-btn {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <nav class="top-nav" aria-label="Main navigation">
    <a href="index.html">Home</a>
    <a href="register.html">Register</a>
    <a href="academic.html">Academic</a>
    <a href="activities.html" class="active">Activities</a>
    <a href="meeting.html">Meetings</a>
    <a href="viewdash.html">Dashboard</a>
  </nav>

  <div class="container">
    <a href="index.html" class="back-btn" onclick="if (window.history.length > 1) { window.history.back(); return false; }">
      <span class="back-icon" aria-hidden="true">&#8592;</span>
      <span>Back</span>
    </a>
    <img src="logo.jpg" alt="Nitte Logo" class="logo">
    <h2>Activity Record Entry</h2>
    <h3>(Rotate Screen if things are hidden)</h3>

    <h3>Activities List and their Points</h3>
    <iframe src="list.html"></iframe>

    <form id="activityForm">
      <label for="usn">USN</label>
      <input type="text" id="usn" required />

      <label for="accessKey">Access Key</label>
      <input type="text" id="accessKey" required />

      <label for="semester">Semester</label>
      <select id="semester" required>
        <option value="">Select</option>
        <option value="1">1</option><option value="2">2</option>
        <option value="3">3</option><option value="4">4</option>
        <option value="5">5</option><option value="6">6</option>
        <option value="7">7</option><option value="8">8</option>
      </select>

      <div id="activitiesContainer"></div>

      <div class="button-row">
        <button type="button" class="add-btn" onclick="addActivityRow()">âž• Add Activity</button>
      </div>

      <button type="submit" class="submit-btn">ðŸ“˜ Submit Activities</button>
      <div id="message" class="message"></div>
    </form>
  </div>

  <script>
    const form = document.getElementById("activityForm");
    const container = document.getElementById("activitiesContainer");
    const message = document.getElementById("message");

    const activityTypes = [
      "NSS/NCC/Red Cross", "Sports Participation", "Tech Symposium", "Cultural Event",
      "Paper Presentation", "Internship", "Research Project", "Workshop Attended",
      "Seminar Given", "Student Club Work", "Community Service", "Technical Training",
      "Hackathon", "Startup Work", "Innovation Contest", "MOOC Certification",
      "Project Expo", "Other"
    ];

    function createTypeOptions() {
      return activityTypes.map(type => `<option value="${type}">${type}</option>`).join('');
    }

    function addActivityRow() {
  const div = document.createElement("div");
  div.className = "activity-row";
  div.innerHTML = `
    <input type="date" placeholder="Date" required>
    <input type="text" placeholder="Event Details" required>
    <input type="number" placeholder="Activity Points (Consult Mentor)" required>
    <select required><option value="">Activity Type</option>${createTypeOptions()}</select>
    <input type="text" placeholder="Proof Link (Google Drive URL)" required>
    <button type="button" class="delete-btn" onclick="this.parentElement.remove()">Ã—</button>
  `;
  container.appendChild(div);

  // smooth scroll to view
  div.scrollIntoView({ behavior: "smooth", block: "center" });
}

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      message.innerHTML = '<div class="loader"></div><br>Uploading Entries. Please Wait!!!';
      message.className = "message wait";

      if (!confirm("Are you sure you want to submit the activity records?")) return;

      const usn = document.getElementById("usn").value.trim();
      const accessKey = document.getElementById("accessKey").value.trim();
      const semester = document.getElementById("semester").value;

      const verify = await fetch(`https://script.google.com/macros/s/AKfycbzRMrKi2BFLuEhIs4NJx3XwDgKwNomCPpWlxH9C64tDcAMskkziUcSHXgWSL3ZgNUvE/exec?formType=lookup&usn=${encodeURIComponent(usn)}`);
      const verifyData = await verify.json();
      if (!verifyData.success || verifyData.data[6] !== accessKey) {
        message.textContent = "Invalid USN or Access Key.";
        message.className = "message error";
        return;
      }

      const rows = document.querySelectorAll(".activity-row");
      for (let row of rows) {
        const inputs = row.querySelectorAll("input, select");
        const formData = new URLSearchParams();
        formData.append("formType", "activity");
        formData.append("usn", usn);
        formData.append("accessKey", accessKey);
        formData.append("semester", semester);
        formData.append("date", inputs[0].value);
        formData.append("event_details", inputs[1].value);
        formData.append("credit_points", inputs[2].value);
        formData.append("activity_type", inputs[3].value);
        formData.append("proof_link", inputs[4].value);

        try {
          const res = await fetch("https://script.google.com/macros/s/AKfycbzRMrKi2BFLuEhIs4NJx3XwDgKwNomCPpWlxH9C64tDcAMskkziUcSHXgWSL3ZgNUvE/exec", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: formData.toString()
          });
          const result = await res.json();
          if (!result.success) throw new Error(result.error);
        } catch (err) {
          console.error(err);
          message.textContent = "Failed to save one or more activity records.";
          message.className = "message error";
          return;
        }
      }

      message.textContent = "All activity records submitted successfully. Please submit the hardcopy of the Activities to your Mentor.";
      message.className = "message success";
      form.reset();
      container.innerHTML = "";
    });
  </script>
</body>
</html>
